{% extends "main/verification_child.html" %}

{% load i18n %}
{% load static %}

{% block inner_body %}
    <!-- header START -->
    <header style="margin: 0 !important; background: var(--white);">
        <nav class="container-fluid border-bottom">
            <div class="row align-items-center" style="min-height: 52px;">
                <div class="col-auto">
                    <span class="fw-semibold" style="font-size: 24px;">{{ project_name }}</span>
                </div>
                <div class="col-lg">
                    <span class="nav-subtitle" style="color: var(--text-secondary);">{{ subtitle }}</span>
                </div>
                <div class="col-auto">
                    <span>{% trans "Archive" %}: <b>{{ prefix }}</b></span>
                    <span class="nav-item-divider"> / </span>
                    <span>{% trans "Unique key" %}: <b class="uk">{{ unique_key }}</b></span>
                    <span class="nav-item-divider"> / </span>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#stats_modal">{% trans "Stats" %}</a>
                    <span class="nav-item-divider"> / </span>
                    <a href="{% url 'verification' %}">{% trans "End session" %}</a>
                </div>
            </div>
        </nav>
    </header>
    <!-- header END -->

    <!-- main START -->
    <main class="content">
        <div class="row" style="margin: 0; padding: 0;">
            <div id="frame_panel" class="col-lg-7" style="margin: 0; padding: 0; z-index: 1; background: var(--light);">
                {{ score_result }}
            </div>
            <div id="frame_image" class="col-lg-5"
                 style="margin: 0; padding: 0; display: flex; align-items: flex-end;">
                <img id="img_threshold" src="{{ img_threshold_url }}" alt="threshold image">
            </div>
        </div>
    </main>
    <!-- main END -->

    <!--footer START -->
    <footer style="margin: 0; padding: 0; background: white; border-top: 1px solid var(--bs-border-color);">
        <div class="row" style="margin: 0; padding: 0;">
            <div class="col-lg-7" style="margin: 0; padding: 0;">

            </div>
            <div class="col-lg-5" style="margin: 0; padding: 12px; display: flex; justify-content: flex-end;">
                <a class="btn btn-light" style="min-width: 152px; margin-right: 12px;"
                   href="{% url 'capture' prefix=prefix %}">
                    {% trans "Back to scanning" %}
                </a>
                <button class="btn btn-primary" style="min-width: 152px;">
                    {% trans "Accept" %}
                </button>
            </div>
        </div>
    </footer>
    <!--footer END -->
{% endblock %}

{% block extra_js_custom_logic %}
    <script>
        // add "custom-container" class to body
        document.body.classList.add("custom-container");

        // init elements
        let header = document.querySelector("header");
        let footer = document.querySelector("footer");
        let frame_panel = document.getElementById("frame_panel");
        let frame_image = document.getElementById("frame_image");
        let img_threshold = document.getElementById("img_threshold");

        // calculate elements' size
        function calc_sizes() {
            let w = window.innerWidth;
            let h = window.innerHeight;
            if (w >= 992) {
                frame_panel.style.height = `${h - header.offsetHeight - footer.offsetHeight}px`;
                if (h - header.offsetHeight - footer.offsetHeight >= w * 5 / 12) {
                    frame_image.style.justifyContent = "space-around";
                    frame_image.style.flexDirection = "column";
                    img_threshold.style.width = `${w * 5 / 12}px`;
                    img_threshold.style.height = "auto";
                } else {
                    frame_image.style.justifyContent = "flex-end";
                    frame_image.style.flexDirection = "row";
                    img_threshold.style.height = `${h - header.offsetHeight - footer.offsetHeight}px`;
                    img_threshold.style.width = "auto";
                }
            } else {
                frame_panel.style.height = `${h - header.offsetHeight}px`;
                img_threshold.style.width = `${w}px`;
                img_threshold.style.height = "auto";
            }
        }

        // activate resize
        window.addEventListener("resize", calc_sizes);
        calc_sizes();
    </script>
{% endblock %}